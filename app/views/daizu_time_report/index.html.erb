<script src="/javascripts/calendar/calendar.js" type="text/javascript"></script>
<script src="/javascripts/calendar/lang/calendar-ja.js" type="text/javascript"></script>
<script src="/javascripts/calendar/calendar-setup.js" type="text/javascript"></script>
<link href="/stylesheets/calendar.css" media="screen" rel="stylesheet" type="text/css" />

<h2><%= link_to h('大豆トップページ'), :controller => 'daizu_main', :action => 'index' %> ＞ タイムレポート</h2>

<% form_tag({ :controller => 'daizu_time_report', :action => 'index' }, :id => 'query_form') do %>
  <p><label for="issue_start_date">開始日</label>
  <input id="issue_start_date" name="start_date" size="15" type="text" value="<%= params[:start_date] %>" />
  <img alt="Calendar" class="calendar-trigger" id="issue_start_date_trigger" src="/images/calendar.png" />
  <script type="text/javascript">
  //<![CDATA[
  Calendar.setup({inputField : 'issue_start_date', ifFormat : '%Y-%m-%d', button : 'issue_start_date_trigger' });
  //]]>
  </script></p>

  <p><label for="issue_due_date">期限日</label>
  <input id="issue_due_date" name="due_date" size="15" type="text" value="<%= params[:due_date] %>" />
  <img alt="Calendar" class="calendar-trigger" id="issue_due_date_trigger" src="/images/calendar.png" />
  <script type="text/javascript">
  //<![CDATA[
  Calendar.setup({inputField : 'issue_due_date', ifFormat : '%Y-%m-%d', button : 'issue_due_date_trigger' });
  //]]>
  </script></p>

  <button type="submit">GO</button>
<% end %>

<% if @results %>
<p>[from:<%= params[:start_date] %> to:<%= params[:due_date] %>] のタイムレポート。</p>

  <table class="list">
    <tr>
      <th></th>
      <% @trackers.each do |tracker| %>
        <th colspan="3" ><%= tracker.name %></th>
      <% end %>
    </tr>
    <tr>
      <th></th>
      <% @trackers.each do |tracker| %>
        <th>予想</th>
        <th>実績</th>
        <th>進捗</th>
      <% end %>
    </tr>
    <% @results.each do |result| %>
      <tr>
        <th><%= result.project_name %></th>
        <% @trackers.each do |tracker| %>
          <td><%= result.get_tracker(tracker.name).estimated_hours %></td>
          <td><%= result.get_tracker(tracker.name).actual_performances %></td>
          <td>
            <table class="progress" style="width: 80px;">
              <tr>
                <% if result.get_tracker(tracker.name).percentages == 0 %>
                  <td class="todo" style="width:100%;"></td>
                <% elsif result.get_tracker(tracker.name).percentages == 100 %>
                  <td class="closed" style="width:100%;"></td>
                <% elsif result.get_tracker(tracker.name).percentages > 100 %>
                  <td style="width:100%;background-color:red;"></td>
                <% else %>
                  <td class="closed" style="<%= "width:" + result.get_tracker(tracker.name).percentages.to_s + "%;" %>"></td>
                  <td class="todo" style="<%= "width:" + (100 - result.get_tracker(tracker.name).percentages).to_s + "%;" %>"></td>
                <% end %>
              </tr>
            </table>
            <p class="pourcent"><%= result.get_tracker(tracker.name).percentages.to_s %>%</p>
          </td>
        <% end %>
      </tr>
     <% end %>
  </table>
  
<% end %>

